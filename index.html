<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éû„Ç§Êó•Ë®òÂ∏≥2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans JP', sans-serif; background: #f5f5f5; }
        header { background: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        h1 { font-size: 24px; cursor: pointer; color: #333; }
        .header-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .search-group { display: flex; gap: 5px; }
        .btn { padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; }
        .btn:hover { background: #f0f0f0; }
        .btn-new { background: #4a90e2; color: white; border-color: #4a90e2; }
        .btn-new:hover { background: #357abd; }
        .btn-search { background: #4a90e2; color: white; border-color: #4a90e2; padding: 8px 12px; }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; display: flex; gap: 30px; }
        .main-content { flex: 1; min-width: 0; }
        
        .year-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .year-tab { padding: 10px 20px; background: white; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; }
        .year-tab:hover { border-color: #4a90e2; }
        .year-tab.active { background: #4a90e2; color: white; border-color: #4a90e2; }
        
        .months-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 30px; }
        .month-box { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-top: 4px solid; }
        .month-box:nth-child(1) { border-top-color: #ff6b6b; }
        .month-box:nth-child(2) { border-top-color: #ee5a6f; }
        .month-box:nth-child(3) { border-top-color: #c44569; }
        .month-box:nth-child(4) { border-top-color: #786fa6; }
        .month-box:nth-child(5) { border-top-color: #4a69bd; }
        .month-box:nth-child(6) { border-top-color: #0fbcf9; }
        .month-box:nth-child(7) { border-top-color: #00d2d3; }
        .month-box:nth-child(8) { border-top-color: #7bed9f; }
        .month-box:nth-child(9) { border-top-color: #feca57; }
        .month-box:nth-child(10) { border-top-color: #ff9ff3; }
        .month-box:nth-child(11) { border-top-color: #ff6348; }
        .month-box:nth-child(12) { border-top-color: #ff4757; }
        
        .month-header { font-size: 14px; font-weight: 600; margin-bottom: 12px; text-align: center; color: #333; }
        .date-list { display: flex; flex-direction: column; gap: 6px; }
        .date-item { padding: 6px 8px; background: #f9f9f9; border-radius: 4px; font-size: 11px; transition: all 0.3s ease; }
        .date-item.has-entry { background: #e8f4ff; border-left: 3px solid #4a90e2; cursor: pointer; }
        .date-item.has-entry:hover { background: #d0e8ff; transform: translateX(2px); }
        .date-item.no-entry { background: #fafafa; color: #ccc; cursor: default; }
        .date-label { font-weight: 500; font-size: 10px; }
        .date-item.has-entry .date-label { color: #333; }
        .date-item.no-entry .date-label { color: #ccc; }
        .date-title { color: #333; margin-top: 2px; font-size: 11px; }
        .show-more-btn { margin-top: 10px; padding: 6px; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; width: 100%; font-size: 11px; transition: all 0.3s ease; }
        .show-more-btn:hover { background: #e0e0e0; }
        
        .sidebar { width: 300px; position: sticky; top: 100px; height: fit-content; }
        .sidebar-section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .sidebar-title { font-size: 16px; font-weight: 600; margin-bottom: 15px; }
        .profile { text-align: center; }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; cursor: pointer; transition: all 0.3s ease; object-fit: cover; }
        .profile-img:hover { transform: scale(1.05); }
        .profile-name { font-size: 16px; font-weight: 600; margin-bottom: 5px; cursor: pointer; transition: color 0.3s ease; }
        .profile-name:hover { color: #4a90e2; }
        .profile-bio { font-size: 12px; color: #666; }
        
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .calendar-nav button { background: none; border: none; cursor: pointer; font-size: 16px; padding: 5px; transition: color 0.3s ease; }
        .calendar-nav button:hover { color: #4a90e2; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 11px; border-radius: 4px; background: #f9f9f9; transition: all 0.3s ease; }
        .calendar-day.has-entry { background: #4a90e2; color: white; font-weight: 600; cursor: pointer; }
        .calendar-day.has-entry:hover { background: #357abd; }
        .calendar-day.other-month { opacity: 0.3; cursor: default; }
        
        .entry-list { display: flex; flex-direction: column; gap: 10px; }
        .entry-item { padding: 10px; background: #f9f9f9; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; }
        .entry-item:hover { background: #e8f4ff; transform: translateX(2px); }
        .entry-date { font-size: 10px; color: #999; margin-bottom: 3px; }
        .entry-title { font-size: 13px; color: #333; font-weight: 500; }
        .view-more { display: block; text-align: center; padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; text-decoration: none; margin-top: 10px; font-size: 13px; cursor: pointer; transition: all 0.3s ease; }
        .view-more:hover { background: #e0e0e0; }
        
        .page-container { background: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .article-nav { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 10px; flex-wrap: wrap; }
        .nav-link { padding: 10px 15px; background: #f0f0f0; border-radius: 4px; text-decoration: none; color: #333; font-size: 14px; transition: all 0.3s ease; }
        .nav-link:hover { background: #e0e0e0; }
        .article-header { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .article-title { font-size: 28px; font-weight: 600; margin-bottom: 10px; color: #333; }
        .article-meta { display: flex; gap: 15px; color: #666; font-size: 14px; flex-wrap: wrap; align-items: center; }
        .article-content { line-height: 1.8; font-size: 16px; margin-bottom: 30px; color: #333; }
        .article-content p { margin-bottom: 15px; }
        .article-content img { width: 100%; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .article-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 20px; }
        .tag { padding: 5px 12px; background: #f0f0f0; border-radius: 20px; font-size: 12px; color: #666; }
        
        .comments-section { margin-top: 40px; padding-top: 30px; border-top: 2px solid #eee; }
        .comments-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .comment-form textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical; min-height: 80px; margin-bottom: 10px; font-family: inherit; }
        .comment-item { padding: 15px; background: #f9f9f9; border-radius: 4px; margin-bottom: 10px; }
        .comment-meta { color: #999; font-size: 12px; margin-bottom: 5px; }
        .comment-text { color: #333; font-size: 14px; line-height: 1.6; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; }
        .form-group textarea { min-height: 200px; resize: vertical; line-height: 1.6; }
        .form-actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .image-preview-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .image-preview-item { position: relative; width: 100px; height: 100px; }
        .image-preview-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; }
        .image-remove { position: absolute; top: -5px; right: -5px; background: #ff4757; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1; }
        
        .articles-list { display: flex; flex-direction: column; gap: 20px; }
        .article-card { background: white; border-radius: 8px; padding: 20px; display: flex; gap: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; }
        .article-card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .article-thumbnail { width: 120px; height: 120px; border-radius: 4px; object-fit: cover; flex-shrink: 0; }
        .article-info { flex: 1; min-width: 0; }
        .article-list-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #333; }
        .article-excerpt { font-size: 14px; color: #666; margin-bottom: 8px; }
        
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 30px; flex-wrap: wrap; }
        .page-btn { min-width: 35px; height: 35px; padding: 0 10px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; }
        .page-btn:hover { background: #f0f0f0; }
        .page-btn.active { background: #4a90e2; color: white; border-color: #4a90e2; }
        
        .profile-content { display: flex; gap: 40px; margin-bottom: 30px; flex-wrap: wrap; }
        .profile-image-section { text-align: center; }
        .profile-large-img { width: 200px; height: 200px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; }
        .profile-details { flex: 1; min-width: 300px; }
        .profile-name-large { font-size: 24px; font-weight: 600; margin-bottom: 20px; }
        .profile-item { display: flex; padding: 10px 0; border-bottom: 1px solid #eee; }
        .profile-label { width: 140px; color: #666; font-weight: 500; }
        .profile-value { flex: 1; color: #333; }
        
        .hidden { display: none !important; }
        
        @media (max-width: 1200px) {
            .months-grid { grid-template-columns: repeat(4, 1fr); }
        }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; position: static; }
            .months-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1 onclick="showDashboard()">„Éû„Ç§Êó•Ë®òÂ∏≥2</h1>
            <div id="customLinksContainer" style="display: flex; gap: 10px; align-items: center;"></div>
            <div class="header-actions">
                <div class="search-group">
                    <input type="text" id="searchInput" placeholder="Ë®ò‰∫ã„ÇíÊ§úÁ¥¢..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 180px;">
                    <button class="btn btn-search" onclick="searchArticles()">üîç Ê§úÁ¥¢</button>
                </div>
                <button class="btn btn-new" onclick="showNewArticle()">‚úèÔ∏è Êñ∞Ë¶èË®ò‰∫ã</button>
                <button class="btn" onclick="exportData()">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                <button class="btn" onclick="importData()">„Ç§„É≥„Éù„Éº„Éà</button>
            </div>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <div id="dashboard"></div>
            <div id="articlePage" class="hidden"></div>
            <div id="editPage" class="hidden"></div>
            <div id="listPage" class="hidden"></div>
            <div id="profilePage" class="hidden"></div>
        </main>

        <aside class="sidebar">
            <div class="sidebar-section profile">
                <img id="sidebarProfileImg" src="https://via.placeholder.com/100" alt="Profile" class="profile-img" onclick="showProfilePage()">
                <div id="sidebarProfileName" class="profile-name" onclick="showProfilePage()">Â±±Áî∞ Ëä±Â≠ê</div>
                <div class="profile-bio">ÊØéÊó•„ÇíÂ§ßÂàá„Å´Ë®òÈå≤„Åó„Å¶„ÅÑ„Åæ„Åô</div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">„Ç¢„Éº„Ç´„Ç§„Éñ</div>
                <div class="calendar-header">
                    <span id="calendarMonth"></span>
                    <div class="calendar-nav">
                        <button onclick="prevMonth()">‚óÄ</button>
                        <button onclick="nextMonth()">‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">New Entry</div>
                <div class="entry-list" id="newEntryList"></div>
                <div class="view-more" onclick="showArticlesList()">View More</div>
            </div>
        </aside>
    </div>

    <input type="file" id="importFile" accept=".json" style="display:none;">

    <script>
        let articles = {};
        let profile = {
            name: 'Â±±Áî∞ Ëä±Â≠ê',
            birthday: '1995-05-15',
            bloodType: 'A',
            zodiac: '„Åä„ÅÜ„ÅóÂ∫ß',
            height: '160',
            photo: 'https://via.placeholder.com/200',
            custom: [
                { label: 'Ë∂£Âë≥', value: 'Ë™≠Êõ∏„ÄÅÈü≥Ê•ΩÈëëË≥û' },
                { label: 'Â•Ω„Åç„Å™È£ü„ÅπÁâ©', value: '„Ç§„ÉÅ„Ç¥' },
                { label: 'Â∫ßÂè≥„ÅÆÈäò', value: '‰∏ÄÊúü‰∏Ä‰ºö' }
            ]
        };
        let currentYear = 2026;
        let currentMonth = 0;
        let editImages = [];
        let editThumbnail = '';
        let editBlocks = []; // „Éñ„É≠„ÉÉ„ÇØ„Ç®„Éá„Ç£„ÇøÁî®
        let customLinks = [
            { title: '', url: '' },
            { title: '', url: '' }
        ]; // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØÁî®
        
        // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàêÈñ¢Êï∞
        function generateSampleData() {
            const titles = [
                'Êñ∞Âπ¥„ÅÆÊä±Ë≤†', '‰ªäÊó•„ÅÆ„Ç´„Éï„ÇßÂ∑°„Çä', 'ÂèãÈÅî„Å®„É©„É≥„ÉÅ', 'ÈÄ±Êú´„ÅÆÈÅé„Åî„ÅóÊñπ', 
                'Êò†ÁîªÈëëË≥û„ÅÆÊÑüÊÉ≥', 'ÁæéË°ìÈ§®„Å´Ë°å„Å£„Å¶„Åç„Åü', '„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆ„Ç´„Éï„Çß', '‰ªäÊó•„ÅÆÊñôÁêÜ',
                '„É®„Ç¨Âßã„ÇÅ„Åæ„Åó„Åü', 'Ê°ú„ÅåÁ∂∫È∫ó„Å†„Å£„Åü', 'Êñ∞„Åó„ÅÑË∂£Âë≥Áô∫Ë¶ã', 'Ë™≠Êõ∏„ÅÆË®òÈå≤',
                'Èü≥Ê•Ω„ÇíËÅ¥„Åç„Å™„Åå„Çâ', 'Êï£Ê≠©Êó•Âíå', '„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞Êó•Ë®ò', '‰ªäÊó•„ÅÆÊ∞óÂàÜ',
                'ÊÄù„ÅÑÂá∫„ÅÆÂÜôÁúü', 'Â≠£ÁØÄ„ÅÆÂ§â„Çè„ÇäÁõÆ', 'Âπ∏„Åõ„Å™‰∏ÄÊó•', 'Â∞è„Åï„Å™Áô∫Ë¶ã',
                'Êó•Â∏∏„ÅÆÈ¢®ÊôØ', 'Áôí„Åó„ÅÆÊôÇÈñì', 'Â§ßÂàá„Å™ÊôÇÈñì', 'ÂøÉ„Å´ÊÆã„ÇãÂá∫Êù•‰∫ã',
                '‰ªäÊó•„ÅÆ„ÅÇ„Çä„Åå„Å®„ÅÜ', 'Á¥†Êïµ„Å™Âá∫‰ºö„ÅÑ', 'Êñ∞„Åó„ÅÑÊåëÊà¶', 'Ëá™ÂàÜÁ£®„Åç',
                '„É™„Éï„É¨„ÉÉ„Ç∑„É•', 'Á©è„ÇÑ„Åã„Å™ÊôÇÈñì', 'ÂÖÖÂÆü„ÅÆ‰∏ÄÊó•', 'Ê•Ω„Åó„ÅÑ‰∫àÂÆö',
                'ÊÄù„Çè„Å¨Áô∫Ë¶ã', 'ÂøÉÊ∏©„Åæ„ÇãÂá∫Êù•‰∫ã', '‰ªäÂπ¥„ÅÆÁõÆÊ®ô', 'Â§âÂåñ„ÅÆÂÖÜ„Åó',
                'ÂâçÂêë„Åç„Å™Ê∞óÊåÅ„Å°', 'ÊÑüË¨ù„ÅÆÊ∞óÊåÅ„Å°', 'ÊòéÊó•„Å∏„ÅÆÊúüÂæÖ', '‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü'
            ];
            
            const contents = [
                '‰ªäÊó•„ÅØ„Å®„Å¶„ÇÇËâØ„ÅÑÂ§©Ê∞ó„Åß„Åó„Åü„ÄÇÊúù„Åã„ÇâÊ∞óÂàÜ„ÅåËâØ„Åè„Å¶„ÄÅ„ÅÑ„Å§„ÇÇ„Çà„ÇäÊó©Ëµ∑„Åç„Åß„Åç„Åæ„Åó„Åü„ÄÇÊúùÈ£ü„ÇÇ„ÇÜ„Å£„Åè„ÇäÊ•Ω„Åó„ÇÅ„Å¶„ÄÅÂπ∏„Åõ„Å™‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ\n\n„Åì„Çì„Å™Êó•„ÅØÂ§ñ„Å´Âá∫„Åã„Åë„Åü„Åè„Å™„Çä„Åæ„Åô„Å≠„ÄÇËøëÊâÄ„ÇíÊï£Ê≠©„Åó„Å™„Åå„Çâ„ÄÅÂ≠£ÁØÄ„ÅÆÂ§âÂåñ„ÇíÊÑü„Åò„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇÂ∞è„Åï„Å™Âπ∏„Åõ„ÇíË¶ã„Å§„Åë„Çâ„Çå„ÇãÊó•„ÄÖ„Å´ÊÑüË¨ù„Åß„Åô„ÄÇ',
                '‰πÖ„Åó„Å∂„Çä„Å´ÂèãÈÅî„Å®‰ºö„Å£„Å¶„ÄÅ„Åü„Åè„Åï„ÇìË©±„Çí„Åó„Åæ„Åó„Åü„ÄÇ„Åä‰∫í„ÅÑ„ÅÆËøëÊ≥Å„ÇíÂ†±Âëä„ÅóÂêà„Å£„Å¶„ÄÅÊòîË©±„Å´„ÇÇËä±„ÅåÂí≤„Åç„Åæ„Åó„Åü„ÄÇ\n\n„Åì„ÅÜ„ÅÑ„ÅÜÊôÇÈñì„Å£„Å¶Êú¨ÂΩì„Å´Â§ßÂàá„Å†„Å™„Å®Êîπ„ÇÅ„Å¶ÊÑü„Åò„Åæ„Åó„Åü„ÄÇ„Åæ„ÅüËøë„ÅÑ„ÅÜ„Å°„Å´‰ºö„ÅÜÁ¥ÑÊùü„Çí„Åó„Å¶„ÄÅ‰ªäÊó•„ÅØÊ•Ω„Åó„ÅÑ‰∏ÄÊó•„Åß„Åó„Åü„ÄÇ',
                'Êñ∞„Åó„ÅÑ„Åì„Å®„Å´ÊåëÊà¶„Åó„Å¶„Åø„Åæ„Åó„Åü„ÄÇÊúÄÂàù„ÅØ‰∏çÂÆâ„ÇÇ„ÅÇ„Çä„Åæ„Åó„Åü„Åå„ÄÅ„ÇÑ„Å£„Å¶„Åø„Çã„Å®ÊÑèÂ§ñ„Å®Ê•Ω„Åó„Åè„Å¶„ÄÅ„ÇÇ„Å£„Å®Á∂ö„Åë„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åó„Åü„ÄÇ\n\n‰Ωï‰∫ã„ÇÇ„ÇÑ„Å£„Å¶„Åø„Å™„ÅÑ„Å®„Çè„Åã„Çâ„Å™„ÅÑ„ÇÇ„ÅÆ„Åß„Åô„Å≠„ÄÇ„Åì„Çå„Åã„Çâ„ÇÇËâ≤„ÄÖ„Å™„Åì„Å®„Å´„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„ÅÑ„Åç„Åü„ÅÑ„Åß„Åô„ÄÇ'
            ];
            
            const categories = ['Êó•Â∏∏', '„ÅäÂá∫„Åã„Åë', 'Ë∂£Âë≥', 'È£ü‰∫ã', 'ÂèãÈÅî', '‰ªï‰∫ã', 'ÂÅ•Â∫∑'];
            const tagsList = [
                ['Êó•Â∏∏', 'ÊÄù„ÅÑÂá∫'],
                ['„Ç´„Éï„Çß', '„Ç∞„É´„É°'],
                ['ÂèãÈÅî', 'Ê•Ω„Åó„ÅÑ'],
                ['Ë∂£Âë≥', 'Êñ∞Áô∫Ë¶ã'],
                ['Êò†Áîª', '„Ç®„É≥„Çø„É°'],
                ['„Ç¢„Éº„Éà', 'ÁæéË°ìÈ§®'],
                ['ÊñôÁêÜ', 'Êâã‰Ωú„Çä'],
                ['ÂÅ•Â∫∑', 'ÈÅãÂãï'],
                ['Ë™≠Êõ∏', 'Êú¨'],
                ['Èü≥Ê•Ω', '„É™„É©„ÉÉ„ÇØ„Çπ']
            ];
            
            // 2026Âπ¥„ÅÆ„Éá„Éº„ÇøÔºà30‰ª∂Ôºâ
            const dates2026 = [
                // 1Êúà: 8‰ª∂
                '2026-01-01', '2026-01-03', '2026-01-05', '2026-01-08', 
                '2026-01-10', '2026-01-15', '2026-01-18', '2026-01-25',
                // 2Êúà: 7‰ª∂
                '2026-02-02', '2026-02-05', '2026-02-08', '2026-02-10', 
                '2026-02-14', '2026-02-20', '2026-02-28',
                // 3Êúà: 5‰ª∂
                '2026-03-03', '2026-03-08', '2026-03-12', '2026-03-18', '2026-03-25',
                // 4Êúà: 3‰ª∂
                '2026-04-05', '2026-04-12', '2026-04-20',
                // 5Êúà: 3‰ª∂
                '2026-05-03', '2026-05-15', '2026-05-28',
                // 6Êúà: 2‰ª∂
                '2026-06-10', '2026-06-22',
                // 7Êúà: 2‰ª∂
                '2026-07-07', '2026-07-21'
            ];
            
            // 2025Âπ¥„ÅÆ„Éá„Éº„ÇøÔºà10‰ª∂Ôºâ
            const dates2025 = [
                // 12Êúà: 5‰ª∂
                '2025-12-03', '2025-12-10', '2025-12-15', '2025-12-25', '2025-12-31',
                // 11Êúà: 3‰ª∂
                '2025-11-05', '2025-11-15', '2025-11-28',
                // 10Êúà: 2‰ª∂
                '2025-10-10', '2025-10-25'
            ];
            
            const allDates = [...dates2026, ...dates2025];
            
            allDates.forEach((date, i) => {
                const hour = 9 + Math.floor(Math.random() * 12);
                const minute = Math.floor(Math.random() * 60);
                const timestamp = new Date(date + `T${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}:00`).getTime();
                
                articles[date] = {
                    title: titles[i % titles.length],
                    content: contents[i % contents.length],
                    timestamp: timestamp,
                    images: [
                        `https://picsum.photos/800/600?random=${i}a`,
                        `https://picsum.photos/800/600?random=${i}b`
                    ],
                    thumbnail: `https://picsum.photos/400/400?random=${i}`,
                    tags: tagsList[i % tagsList.length],
                    category: categories[i % categories.length],
                    status: 'published',
                    comments: (i % 5 === 0) ? [{
                        text: '„Åì„ÅÆÊó•„ÅÆ„Åì„Å®„ÅØ‰ªä„Åß„ÇÇË¶ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¥†Êïµ„Å™‰∏ÄÊó•„Åß„Åó„Åü„Å≠„ÄÇ',
                        timestamp: timestamp + 3600000
                    }] : []
                };
            });
            
            console.log('„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü:', Object.keys(articles).length, '‰ª∂');
        }
        
        // ÂàùÊúüÂåñ
        function init() {
            console.log('ÂàùÊúüÂåñÈñãÂßã...');
            
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            const storedArticles = localStorage.getItem('diary2_articles');
            const storedProfile = localStorage.getItem('diary2_profile');
            
            if (storedArticles) {
                articles = JSON.parse(storedArticles);
                console.log('Êó¢Â≠ò„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:', Object.keys(articles).length, '‰ª∂');
            } else {
                // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åø„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁîüÊàê
                console.log('„Éá„Éº„Çø„Åå„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Åæ„Åô');
                generateSampleData();
                saveData();
            }
            
            if (storedProfile) {
                profile = JSON.parse(storedProfile);
            }
            
            // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØ„ÇíË™≠„ÅøËæº„Åø
            const storedLinks = localStorage.getItem('diary2_custom_links');
            if (storedLinks) {
                customLinks = JSON.parse(storedLinks);
            }
            
            // ÁîªÈù¢„ÇíÊèèÁîª
            renderDashboard();
            renderCalendar();
            renderNewEntry();
            updateSidebarProfile(); // „Çµ„Ç§„Éâ„Éê„Éº„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÊõ¥Êñ∞
            renderCustomLinks(); // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØ„ÇíÊèèÁîª
            
            console.log('ÂàùÊúüÂåñÂÆå‰∫Ü');
        }
        
        // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØ„ÅÆÊèèÁîª
        function renderCustomLinks() {
            const container = document.getElementById('customLinksContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            customLinks.forEach((link, idx) => {
                const linkDiv = document.createElement('div');
                linkDiv.style.cssText = 'display: flex; align-items: center; gap: 5px;';
                
                if (link.title && link.url) {
                    // „É™„É≥„ÇØ„Åå„ÅÇ„ÇãÂ†¥Âêà
                    const linkBtn = document.createElement('a');
                    linkBtn.href = link.url;
                    linkBtn.target = '_blank';
                    linkBtn.className = 'btn';
                    linkBtn.textContent = link.title;
                    linkBtn.style.cssText = 'text-decoration: none; background: #f0f0f0;';
                    linkDiv.appendChild(linkBtn);
                } else {
                    // „É™„É≥„ÇØ„ÅåÁ©∫„ÅÆÂ†¥Âêà
                    const emptyBtn = document.createElement('button');
                    emptyBtn.className = 'btn';
                    emptyBtn.textContent = '„É™„É≥„ÇØ' + (idx + 1);
                    emptyBtn.style.cssText = 'background: #f9f9f9; color: #999; border-style: dashed;';
                    emptyBtn.onclick = () => editCustomLink(idx);
                    linkDiv.appendChild(emptyBtn);
                }
                
                // Á∑®ÈõÜ„Éú„Çø„É≥
                const editBtn = document.createElement('button');
                editBtn.innerHTML = '‚úèÔ∏è';
                editBtn.style.cssText = 'background: none; border: none; cursor: pointer; font-size: 14px; padding: 0 5px;';
                editBtn.title = 'Á∑®ÈõÜ';
                editBtn.onclick = () => editCustomLink(idx);
                linkDiv.appendChild(editBtn);
                
                container.appendChild(linkDiv);
            });
        }
        
        // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØ„ÅÆÁ∑®ÈõÜ
        function editCustomLink(idx) {
            const link = customLinks[idx];
            
            // „É¢„Éº„ÉÄ„É´HTML
            const modalHTML = `
                <div id="linkEditModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                    <div style="background: white; border-radius: 8px; padding: 30px; width: 90%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                        <h3 style="margin-bottom: 20px; font-size: 20px;">„É™„É≥„ÇØÁ∑®ÈõÜ</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">„Çø„Ç§„Éà„É´Ôºà„Éö„Éº„Ç∏ÂêçÔºâ:</label>
                            <input type="text" id="linkTitle" value="${link.title || ''}" placeholder="‰æã: ÊäïË≥áÊó•Ë®ò" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">URL:</label>
                            <input type="url" id="linkUrl" value="${link.url || ''}" placeholder="https://..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="closeCustomLinkModal()" class="btn">„Ç≠„É£„É≥„Çª„É´</button>
                            <button onclick="saveCustomLink(${idx})" class="btn btn-new">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            `;
            
            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            const modalDiv = document.createElement('div');
            modalDiv.innerHTML = modalHTML;
            document.body.appendChild(modalDiv);
        }
        
        // „Ç´„Çπ„Çø„É†„É™„É≥„ÇØ„ÅÆ‰øùÂ≠ò
        function saveCustomLink(idx) {
            const title = document.getElementById('linkTitle').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            
            customLinks[idx] = { title, url };
            localStorage.setItem('diary2_custom_links', JSON.stringify(customLinks));
            
            closeCustomLinkModal();
            renderCustomLinks();
        }
        
        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeCustomLinkModal() {
            const modal = document.getElementById('linkEditModal');
            if (modal) {
                modal.parentElement.remove();
            }
        }
        
        // „Çµ„Ç§„Éâ„Éê„Éº„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateSidebarProfile() {
            const nameElement = document.getElementById('sidebarProfileName');
            const imgElement = document.getElementById('sidebarProfileImg');
            
            if (nameElement) {
                nameElement.textContent = profile.name;
            }
            if (imgElement && profile.photo) {
                imgElement.src = profile.photo;
            }
        }
        
        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË°®Á§∫
        function renderDashboard() {
            console.log('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊèèÁîªÈñãÂßã...');
            const years = [2026, 2025, 2024];
            let html = '<div class="year-tabs">';
            html += years.map(y => 
                `<div class="year-tab ${y === currentYear ? 'active' : ''}" onclick="changeYear(${y})">${y}</div>`
            ).join('');
            html += '<div class="year-tab" style="border-style: dashed;" onclick="addYear()">+ Âπ¥„ÇíËøΩÂä†</div>';
            html += '</div>';
            
            html += '<div class="months-grid">';
            const monthNames = ['1Êúà','2Êúà','3Êúà','4Êúà','5Êúà','6Êúà','7Êúà','8Êúà','9Êúà','10Êúà','11Êúà','12Êúà'];
            
            for (let m = 1; m <= 12; m++) {
                const daysInMonth = new Date(currentYear, m, 0).getDate();
                const allDays = [];
                
                // „Åù„ÅÆÊúà„ÅÆ„Åô„Åπ„Å¶„ÅÆÊó•‰ªò„ÇíÁîüÊàê
                for (let d = 1; d <= daysInMonth; d++) {
                    const dateKey = `${currentYear}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const art = articles[dateKey];
                    allDays.push({
                        date: dateKey,
                        day: d,
                        article: art,
                        hasEntry: art && art.status === 'published'
                    });
                }
                
                const display5 = allDays.slice(0, 5);
                const hasMore = allDays.length > 5;
                
                html += `<div class="month-box">`;
                html += `<div class="month-header">${monthNames[m-1]}</div>`;
                html += `<div class="date-list" id="month-list-${m}">`;
                
                // ÊúÄÂàù„ÅÆ5Êó•„ÇíË°®Á§∫
                display5.forEach(({ date, day, article, hasEntry }) => {
                    const d = new Date(date);
                    const dow = ['Êó•','Êúà','ÁÅ´','Ê∞¥','Êú®','Èáë','Âúü'][d.getDay()];
                    
                    if (hasEntry) {
                        const isDraft = article.status === 'draft';
                        const bgColor = isDraft ? 'background: #fff9e6; border-left-color: #feca57;' : '';
                        const icon = isDraft ? 'üìù ' : '';
                        html += `<div class="date-item has-entry" style="${bgColor}" onclick="showArticle('${date}')">`;
                        html += `<div class="date-label">${day}Êó•(${dow})</div>`;
                        html += `<div class="date-title">${icon}${article.title}</div>`;
                        html += `</div>`;
                    } else {
                        html += `<div class="date-item no-entry">`;
                        html += `<div class="date-label">${day}Êó•(${dow})</div>`;
                        html += `</div>`;
                    }
                });
                
                html += '</div>';
                
                // „ÇÇ„Å£„Å®Ë¶ã„Çã„Éú„Çø„É≥„Å®ËøΩÂä†Êó•‰ªò
                if (hasMore) {
                    html += `<div class="date-list hidden" id="month-extra-${m}">`;
                    allDays.slice(5).forEach(({ date, day, article, hasEntry }) => {
                        const d = new Date(date);
                        const dow = ['Êó•','Êúà','ÁÅ´','Ê∞¥','Êú®','Èáë','Âúü'][d.getDay()];
                        
                        if (hasEntry) {
                            const isDraft = article.status === 'draft';
                            const bgColor = isDraft ? 'background: #fff9e6; border-left-color: #feca57;' : '';
                            const icon = isDraft ? 'üìù ' : '';
                            html += `<div class="date-item has-entry" style="${bgColor}" onclick="showArticle('${date}')">`;
                            html += `<div class="date-label">${day}Êó•(${dow})</div>`;
                            html += `<div class="date-title">${icon}${article.title}</div>`;
                            html += `</div>`;
                        } else {
                            html += `<div class="date-item no-entry">`;
                            html += `<div class="date-label">${day}Êó•(${dow})</div>`;
                            html += `</div>`;
                        }
                    });
                    html += '</div>';
                    html += `<button class="show-more-btn" id="month-btn-${m}" onclick="toggleMonth(${m})">‚ñº „ÇÇ„Å£„Å®Ë¶ã„Çã</button>`;
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            document.getElementById('dashboard').innerHTML = html;
            console.log('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊèèÁîªÂÆå‰∫Ü');
        }
        
        // Êúà„ÅÆÂ±ïÈñã/Êäò„Çä„Åü„Åü„Åø
        function toggleMonth(m) {
            const extra = document.getElementById(`month-extra-${m}`);
            const btn = document.getElementById(`month-btn-${m}`);
            if (extra.classList.contains('hidden')) {
                extra.classList.remove('hidden');
                btn.textContent = '‚ñ≤ Èñâ„Åò„Çã';
            } else {
                extra.classList.add('hidden');
                btn.textContent = '‚ñº „ÇÇ„Å£„Å®Ë¶ã„Çã';
            }
        }
        
        // Âπ¥„ÅÆÂ§âÊõ¥
        function changeYear(y) {
            currentYear = y;
            renderDashboard();
        }
        
        // Âπ¥„ÅÆËøΩÂä†
        function addYear() {
            const y = prompt('ËøΩÂä†„Åô„ÇãÂπ¥„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æã: 2027Ôºâ:');
            if (y && !isNaN(y)) {
                currentYear = parseInt(y);
                renderDashboard();
            }
        }
        
        // Êñ∞Ë¶èË®ò‰∫ã‰ΩúÊàê
        function showNewArticle() {
            const today = new Date();
            const dateKey = today.getFullYear() + '-' + 
                           String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                           String(today.getDate()).padStart(2, '0');
            showEditPage(dateKey, true);
        }
        
        // Á∑®ÈõÜ„Éö„Éº„Ç∏Ë°®Á§∫
        function showEditPage(date, isNew) {
            const art = isNew ? {
                title: '',
                content: '',
                category: 'Êó•Â∏∏',
                tags: [],
                images: [],
                thumbnail: '',
                blocks: [] // Êñ∞ÊñπÂºè
            } : articles[date];
            
            // „Éñ„É≠„ÉÉ„ÇØÂàùÊúüÂåñ
            if (art.blocks && art.blocks.length > 0) {
                // Êñ∞ÊñπÂºè: „Éñ„É≠„ÉÉ„ÇØ„Çí„Åù„ÅÆ„Åæ„Åæ‰ΩøÁî®
                editBlocks = JSON.parse(JSON.stringify(art.blocks));
            } else if (art.content || (art.images && art.images.length > 0)) {
                // ÊóßÊñπÂºè: content„Å®images„Çí„Éñ„É≠„ÉÉ„ÇØ„Å´Â§âÊèõ
                editBlocks = [];
                if (art.content) {
                    editBlocks.push({ type: 'text', content: art.content });
                }
                if (art.images && art.images.length > 0) {
                    art.images.forEach(img => {
                        editBlocks.push({ type: 'image', data: img });
                    });
                }
            } else {
                // ÂÆåÂÖ®„Å´Êñ∞Ë¶è: Á©∫„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Éñ„É≠„ÉÉ„ÇØ„ÅßÈñãÂßã
                editBlocks = [{ type: 'text', content: '' }];
            }
            
            editImages = art.images ? [...art.images] : [];
            editThumbnail = art.thumbnail || '';
            
            let html = '<div class="page-container">';
            html += '<h2>' + (isNew ? 'Êñ∞Ë¶èË®ò‰∫ã‰ΩúÊàê' : 'Ë®ò‰∫ã„ÇíÁ∑®ÈõÜ') + '</h2>';
            
            html += '<div class="form-group">';
            html += '<label>Êó•‰ªò *</label>';
            html += '<input type="date" id="editDate" value="' + date + '">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>„Çø„Ç§„Éà„É´ *</label>';
            html += '<input type="text" id="editTitle" value="' + art.title + '" placeholder="„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ...">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>Êú¨Êñá„Å®ÁîªÂÉèÔºà„Éñ„É≠„ÉÉ„ÇØÂΩ¢ÂºèÔºâ</label>';
            html += '<div id="blocksContainer" style="margin-top: 10px;"></div>';
            html += '<div style="margin-top: 15px; display: flex; gap: 10px;">';
            html += '<button type="button" class="btn" onclick="addTextBlock()">‚ûï „ÉÜ„Ç≠„Çπ„Éà„Éñ„É≠„ÉÉ„ÇØËøΩÂä†</button>';
            html += '<button type="button" class="btn" onclick="addImageBlock()">üñºÔ∏è ÁîªÂÉè„Éñ„É≠„ÉÉ„ÇØËøΩÂä†</button>';
            html += '</div>';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>„Ç´„ÉÜ„Ç¥„É™„Éº</label>';
            html += '<select id="editCategory">';
            ['Êó•Â∏∏', '„ÅäÂá∫„Åã„Åë', 'Ë∂£Âë≥', 'È£ü‰∫ã', 'ÂèãÈÅî', '‰ªï‰∫ã', 'ÂÅ•Â∫∑'].forEach(cat => {
                html += '<option value="' + cat + '"' + (art.category === cat ? ' selected' : '') + '>' + cat + '</option>';
            });
            html += '</select>';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>„Çø„Ç∞Ôºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÔºâ</label>';
            html += '<input type="text" id="editTags" value="' + (art.tags || []).join(', ') + '" placeholder="‰æã: Êó•Â∏∏, ÊÄù„ÅÑÂá∫">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>„Çµ„É†„Éç„Ç§„É´ÁîªÂÉè</label>';
            html += '<input type="file" id="thumbnailFile" accept="image/*" onchange="handleThumbnailUpload(event)">';
            html += '<div id="thumbnailPreview" style="margin-top:10px;"></div>';
            html += '</div>';
            
            html += '<div class="form-actions">';
            html += '<button class="btn btn-new" onclick="saveArticle(\'' + date + '\', ' + isNew + ', \'published\')">üíæ ‰øùÂ≠ò„Åó„Å¶ÂÖ¨Èñã</button>';
            html += '<button class="btn" style="background: #feca57; color: #333; border-color: #feca57;" onclick="saveArticle(\'' + date + '\', ' + isNew + ', \'draft\')">üìù ‰∏ãÊõ∏„Åç‰øùÂ≠ò</button>';
            html += '<button class="btn" onclick="showDashboard()">„Ç≠„É£„É≥„Çª„É´</button>';
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('editPage').innerHTML = html;
            renderBlocks();
            updateThumbnailPreview();
            showPage('editPage');
        }
        
        // „Éñ„É≠„ÉÉ„ÇØÊèèÁîª
        function renderBlocks() {
            const container = document.getElementById('blocksContainer');
            if (!container) return;
            
            // Êó¢Â≠ò„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆÂÜÖÂÆπ„Çí‰øùÂ≠ò
            const textareas = document.querySelectorAll('[data-block-idx]');
            textareas.forEach((textarea) => {
                const blockIdx = parseInt(textarea.getAttribute('data-block-idx'));
                if (editBlocks[blockIdx] && editBlocks[blockIdx].type === 'text') {
                    editBlocks[blockIdx].content = textarea.value;
                }
            });
            
            container.innerHTML = '';
            
            editBlocks.forEach((block, idx) => {
                const blockDiv = document.createElement('div');
                blockDiv.style.cssText = 'background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e0e0e0;';
                
                let blockHTML = '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                blockHTML += '<strong>' + (block.type === 'text' ? 'üìù „ÉÜ„Ç≠„Çπ„Éà„Éñ„É≠„ÉÉ„ÇØ' : 'üñºÔ∏è ÁîªÂÉè„Éñ„É≠„ÉÉ„ÇØ') + '</strong>';
                blockHTML += '<div style="display: flex; gap: 5px;">';
                if (idx > 0) {
                    blockHTML += '<button type="button" class="btn" onclick="moveBlockUp(' + idx + ')" style="padding: 5px 10px; font-size: 12px;">‚Üë</button>';
                }
                if (idx < editBlocks.length - 1) {
                    blockHTML += '<button type="button" class="btn" onclick="moveBlockDown(' + idx + ')" style="padding: 5px 10px; font-size: 12px;">‚Üì</button>';
                }
                blockHTML += '<button type="button" class="btn" onclick="removeBlock(' + idx + ')" style="padding: 5px 10px; font-size: 12px; background: #ff4757; color: white; border-color: #ff4757;">ÂâäÈô§</button>';
                blockHTML += '</div></div>';
                
                if (block.type === 'text') {
                    blockHTML += '<textarea data-block-idx="' + idx + '" style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 14px; resize: vertical;" placeholder="„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ...">' + (block.content || '') + '</textarea>';
                } else if (block.type === 'image') {
                    if (block.data) {
                        blockHTML += '<img src="' + block.data + '" style="max-width: 100%; height: auto; border-radius: 4px; margin-top: 10px;">';
                    } else {
                        blockHTML += '<input type="file" accept="image/*" onchange="handleBlockImageUpload(event, ' + idx + ')" style="margin-top: 10px;">';
                    }
                }
                
                blockDiv.innerHTML = blockHTML;
                container.appendChild(blockDiv);
            });
        }
        
        // „ÉÜ„Ç≠„Çπ„Éà„Éñ„É≠„ÉÉ„ÇØËøΩÂä†
        function addTextBlock() {
            editBlocks.push({ type: 'text', content: '' });
            renderBlocks();
        }
        
        // ÁîªÂÉè„Éñ„É≠„ÉÉ„ÇØËøΩÂä†
        function addImageBlock() {
            editBlocks.push({ type: 'image', data: '' });
            renderBlocks();
        }
        
        // „Éñ„É≠„ÉÉ„ÇØÂâäÈô§
        function removeBlock(idx) {
            if (confirm('„Åì„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                editBlocks.splice(idx, 1);
                if (editBlocks.length === 0) {
                    editBlocks.push({ type: 'text', content: '' });
                }
                renderBlocks();
            }
        }
        
        // „Éñ„É≠„ÉÉ„ÇØ‰∏äÁßªÂãï
        function moveBlockUp(idx) {
            if (idx > 0) {
                [editBlocks[idx], editBlocks[idx - 1]] = [editBlocks[idx - 1], editBlocks[idx]];
                renderBlocks();
            }
        }
        
        // „Éñ„É≠„ÉÉ„ÇØ‰∏ãÁßªÂãï
        function moveBlockDown(idx) {
            if (idx < editBlocks.length - 1) {
                [editBlocks[idx], editBlocks[idx + 1]] = [editBlocks[idx + 1], editBlocks[idx]];
                renderBlocks();
            }
        }
        
        // „Éñ„É≠„ÉÉ„ÇØÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
        function handleBlockImageUpload(event, idx) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                editBlocks[idx].data = e.target.result;
                renderBlocks();
            };
            reader.readAsDataURL(file);
        }
        
        // „Çµ„É†„Éç„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                editThumbnail = e.target.result;
                updateThumbnailPreview();
            };
            reader.readAsDataURL(file);
        }
        
        // „Çµ„É†„Éç„Ç§„É´„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
        function updateThumbnailPreview() {
            const preview = document.getElementById('thumbnailPreview');
            if (!preview) return;
            if (editThumbnail) {
                preview.innerHTML = '<img src="' + editThumbnail + '" style="width:120px;height:120px;object-fit:cover;border-radius:4px;">';
            } else {
                preview.innerHTML = '';
            }
        }
        
        // Ë®ò‰∫ã‰øùÂ≠ò
        function saveArticle(originalDate, isNew, saveStatus) {
            const newDate = document.getElementById('editDate').value;
            const title = document.getElementById('editTitle').value.trim();
            
            if (!newDate || !title) {
                alert('Êó•‰ªò„ÄÅ„Çø„Ç§„Éà„É´„ÅØÂøÖÈ†à„Åß„Åô');
                return;
            }
            
            // Âêå„ÅòÊó•‰ªò„Å´Êó¢„Å´Ë®ò‰∫ã„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆÁ¢∫Ë™ç
            if (articles[newDate] && newDate !== originalDate) {
                const existingArticle = articles[newDate];
                const statusText = existingArticle.status === 'draft' ? '‰∏ãÊõ∏„Åç' : 'Ë®ò‰∫ã';
                
                if (saveStatus === 'draft') {
                    // ‰∏ãÊõ∏„Åç‰øùÂ≠ò„ÅÆÂ†¥Âêà„ÄÅÊó¢Â≠ò„ÅÆ‰∏ãÊõ∏„Åç„ÇíÈñã„Åè
                    alert('„Åì„ÅÆÊó•‰ªò„Å´„ÅØÊó¢„Å´' + statusText + '„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁ∑®ÈõÜÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô„ÄÇ');
                    showEditPage(newDate, false);
                    return;
                } else {
                    // ÂÖ¨Èñã„ÅÆÂ†¥Âêà„ÄÅ‰∏äÊõ∏„ÅçÁ¢∫Ë™ç
                    if (!confirm('„Åì„ÅÆÊó•‰ªò„Å´„ÅØÊó¢„Å´' + statusText + '„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü')) {
                        return;
                    }
                }
            }
            
            // „Éñ„É≠„ÉÉ„ÇØ„Åã„Çâ„Éá„Éº„Çø„ÇíÂèéÈõÜ
            const textareas = document.querySelectorAll('[data-block-idx]');
            textareas.forEach((textarea, idx) => {
                const blockIdx = parseInt(textarea.getAttribute('data-block-idx'));
                if (editBlocks[blockIdx] && editBlocks[blockIdx].type === 'text') {
                    editBlocks[blockIdx].content = textarea.value;
                }
            });
            
            // Á©∫„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„ÇíÂâäÈô§
            const validBlocks = editBlocks.filter(block => {
                if (block.type === 'text') return block.content.trim() !== '';
                if (block.type === 'image') return block.data !== '';
                return false;
            });
            
            if (validBlocks.length === 0) {
                alert('Êú¨Êñá„Åæ„Åü„ÅØÁîªÂÉè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const category = document.getElementById('editCategory').value;
            const tags = document.getElementById('editTags').value
                .split(',')
                .map(t => t.trim())
                .filter(t => t);
            
            // Êó•‰ªò„ÅåÂ§âÊõ¥„Åï„Çå„ÅüÂ†¥Âêà„ÄÅÂÖÉ„ÅÆË®ò‰∫ã„ÇíÂâäÈô§
            if (originalDate !== newDate && articles[originalDate]) {
                delete articles[originalDate];
            }
            
            // „Çµ„É†„Éç„Ç§„É´Ëá™ÂãïË®≠ÂÆöÔºàÊúÄÂàù„ÅÆÁîªÂÉè„Éñ„É≠„ÉÉ„ÇØÔºâ
            if (!editThumbnail) {
                const firstImageBlock = validBlocks.find(b => b.type === 'image');
                if (firstImageBlock) {
                    editThumbnail = firstImageBlock.data;
                }
            }
            
            // Ë®ò‰∫ã„Çí‰øùÂ≠òÔºàÊñ∞ÊñπÂºèÔºâ
            articles[newDate] = {
                title,
                blocks: validBlocks,
                timestamp: (articles[originalDate] && !isNew) ? articles[originalDate].timestamp : Date.now(),
                category,
                tags,
                thumbnail: editThumbnail,
                status: saveStatus || 'published',
                comments: (articles[originalDate] && !isNew) ? articles[originalDate].comments : [],
                // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ‰øùÊåÅ
                content: validBlocks.filter(b => b.type === 'text').map(b => b.content).join('\n\n'),
                images: validBlocks.filter(b => b.type === 'image').map(b => b.data)
            };
            
            saveData();
            renderDashboard();
            renderNewEntry();
            showArticle(newDate);
        }
        
        // Ë®ò‰∫ãË°®Á§∫
        function showArticle(date) {
            const art = articles[date];
            if (!art) {
                if (confirm(`${date}„ÅÆË®ò‰∫ã„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü`)) {
                    showEditPage(date, true);
                }
                return;
            }
            
            // ÂâçÂæå„ÅÆË®ò‰∫ã„ÇíÂèñÂæó
            const all = Object.keys(articles)
                .filter(d => articles[d].status === 'published')
                .sort();
            const idx = all.indexOf(date);
            const prev = idx > 0 ? all[idx - 1] : null;
            const next = idx < all.length - 1 ? all[idx + 1] : null;
            
            let html = '<div class="page-container">';
            
            // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
            html += '<div class="article-nav">';
            if (prev) {
                html += `<a href="javascript:void(0)" class="nav-link" onclick="showArticle('${prev}')">‚Üê ${articles[prev].title}</a>`;
            } else {
                html += '<div></div>';
            }
            html += `<a href="javascript:void(0)" class="nav-link" onclick="showDashboard()">Êàª„Çã</a>`;
            if (next) {
                html += `<a href="javascript:void(0)" class="nav-link" onclick="showArticle('${next}')">${articles[next].title} ‚Üí</a>`;
            } else {
                html += '<div></div>';
            }
            html += '</div>';
            
            // Ë®ò‰∫ã„Éò„ÉÉ„ÉÄ„Éº
            html += '<div class="article-header">';
            if (art.status === 'draft') {
                html += '<div style="display: inline-block; background: #fff9e6; color: #f39c12; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-bottom: 10px;">üìù ‰∏ãÊõ∏„Åç</div>';
            }
            html += '<h2 class="article-title">' + art.title + '</h2>';
            html += '<div class="article-meta">';
            html += '<span>üìÖ Ë®ò‰∫ãÊó•‰ªò: ' + date + '</span>';
            html += '<span>üïí ÊäïÁ®øÊó•ÊôÇ: ' + new Date(art.timestamp).toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }) + '</span>';
            html += '<span>üìÅ ' + art.category + '</span>';
            html += '<button class="btn" onclick="showEditPage(\'' + date + '\', false)">‚úèÔ∏è Á∑®ÈõÜ</button>';
            html += '</div>';
            html += '</div>';
            
            // Ë®ò‰∫ãÊú¨Êñá
            html += '<div class="article-content">';
            
            // Êñ∞ÊñπÂºèÔºà„Éñ„É≠„ÉÉ„ÇØÔºâ„ÅßË°®Á§∫
            if (art.blocks && art.blocks.length > 0) {
                art.blocks.forEach(block => {
                    if (block.type === 'text') {
                        html += block.content.split('\n').map(p => '<p>' + p + '</p>').join('');
                    } else if (block.type === 'image' && block.data) {
                        html += '<img src="' + block.data + '">';
                    }
                });
            } else {
                // ÊóßÊñπÂºèÔºàÊó¢Â≠ò40‰ª∂Áî®Ôºâ
                html += art.content.split('\n').map(p => '<p>' + p + '</p>').join('');
                
                // ÁîªÂÉè
                if (art.images && art.images.length > 0) {
                    html += art.images.map(img => '<img src="' + img + '">').join('');
                }
            }
            
            // „Çø„Ç∞
            if (art.tags && art.tags.length > 0) {
                html += '<div class="article-tags">';
                html += art.tags.map(t => '<span class="tag">#' + t + '</span>').join('');
                html += '</div>';
            }
            html += '</div>';
            
            // „Ç≥„É°„É≥„Éà„Çª„ÇØ„Ç∑„Éß„É≥
            html += '<div class="comments-section">';
            html += '<h3 class="comments-title">üí¨ „Ç≥„É°„É≥„Éà</h3>';
            html += '<div class="comment-form">';
            html += '<textarea id="commentText" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..."></textarea>';
            html += '<button class="btn" onclick="addComment(\'' + date + '\')">„Ç≥„É°„É≥„Éà„ÇíÊäïÁ®ø</button>';
            html += '</div>';
            
            if (art.comments && art.comments.length > 0) {
                html += art.comments.map(c => 
                    '<div class="comment-item">' +
                    '<div class="comment-meta">' + new Date(c.timestamp).toLocaleString('ja-JP') + '</div>' +
                    '<div class="comment-text">' + c.text + '</div>' +
                    '</div>'
                ).join('');
            }
            
            html += '</div>';
            html += '</div>';
            
            document.getElementById('articlePage').innerHTML = html;
            showPage('articlePage');
        }
        
        // „Ç≥„É°„É≥„ÉàËøΩÂä†
        function addComment(date) {
            const text = document.getElementById('commentText').value.trim();
            if (!text) {
                alert('„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!articles[date].comments) {
                articles[date].comments = [];
            }
            
            articles[date].comments.push({
                text: text,
                timestamp: Date.now()
            });
            
            saveData();
            showArticle(date);
        }
        
        // Ë®ò‰∫ã‰∏ÄË¶ßË°®Á§∫ÔºàÊ§úÁ¥¢ÁµêÊûúÂØæÂøúÁâàÔºâ
        let searchQuery = ''; // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÅßÊ§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Çí‰øùÊåÅ
        
        function showArticlesList(page = 1, query = '') {
            searchQuery = query; // Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Çí‰øùÂ≠ò
            
            let all = Object.entries(articles)
                .filter(([_, a]) => a.status === 'published');
            
            // Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            if (query) {
                all = all.filter(([_, a]) => 
                    a.title.toLowerCase().includes(query.toLowerCase()) || 
                    a.content.toLowerCase().includes(query.toLowerCase()) || 
                    (a.tags && a.tags.some(t => t.toLowerCase().includes(query.toLowerCase())))
                );
            }
            
            all = all.sort((a, b) => b[0].localeCompare(a[0]));
            
            const perPage = 10;
            const total = Math.ceil(all.length / perPage);
            const items = all.slice((page - 1) * perPage, page * perPage);
            
            let html = '<div class="page-container">';
            const title = query ? `Ê§úÁ¥¢ÁµêÊûú: "${query}"` : '„Åô„Åπ„Å¶„ÅÆË®ò‰∫ã';
            html += '<h2 style="font-size: 24px; margin-bottom: 30px;">' + title + '</h2>';
            
            if (all.length === 0) {
                html += '<div style="text-align: center; padding: 40px; color: #999;">Ë©≤ÂΩì„Åô„ÇãË®ò‰∫ã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div></div>';
                document.getElementById('listPage').innerHTML = html;
                showPage('listPage');
                return;
            }
            html += '<div class="articles-list">';
            
            items.forEach(([date, art]) => {
                const excerpt = art.content.substring(0, 100) + (art.content.length > 100 ? '...' : '');
                html += `<div class="article-card" onclick="showArticle('${date}')">`;
                html += `<img src="${art.thumbnail || 'https://via.placeholder.com/120'}" class="article-thumbnail">`;
                html += '<div class="article-info">';
                html += '<h3 class="article-list-title">' + art.title + '</h3>';
                html += '<div class="article-excerpt">' + excerpt + '</div>';
                html += '<div class="article-meta">';
                html += '<span>üìÖ ' + date + '</span>'; // ÊåáÂÆöÊó•‰ªò„ÇíË°®Á§∫
                html += '<span>üìÅ ' + art.category + '</span>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
            });
            
            html += '</div>';
            
            // „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥
            if (total > 1) {
                html += '<div class="pagination">';
                for (let p = 1; p <= total; p++) {
                    html += `<button class="page-btn ${p === page ? 'active' : ''}" onclick="showArticlesList(${p}, '${query}')">${p}</button>`;
                }
                html += '</div>';
            }
            
            html += '</div>';
            
            document.getElementById('listPage').innerHTML = html;
            showPage('listPage');
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´„Éö„Éº„Ç∏Ë°®Á§∫
        function showProfilePage() {
            console.log('„Éó„É≠„Éï„Ç£„Éº„É´„Éö„Éº„Ç∏„ÇíË°®Á§∫„Åó„Åæ„Åô');
            
            let html = '<div class="page-container">';
            html += '<h2 style="text-align:center;margin-bottom:30px;">„Éó„É≠„Éï„Ç£„Éº„É´</h2>';
            html += '<div class="profile-content">';
            
            // „Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè„Çª„ÇØ„Ç∑„Éß„É≥
            html += '<div class="profile-image-section">';
            html += '<img src="' + profile.photo + '" class="profile-large-img">';
            html += '<button class="btn" onclick="editProfile()">Á∑®ÈõÜ</button>';
            html += '</div>';
            
            // „Éó„É≠„Éï„Ç£„Éº„É´Ë©≥Á¥∞
            html += '<div class="profile-details">';
            html += '<h3 class="profile-name-large">' + profile.name + '</h3>';
            
            html += '<div class="profile-item">';
            html += '<div class="profile-label">Birthday</div>';
            html += '<div class="profile-value">' + new Date(profile.birthday).toLocaleDateString('ja-JP') + '</div>';
            html += '</div>';
            
            html += '<div class="profile-item">';
            html += '<div class="profile-label">Blood type</div>';
            html += '<div class="profile-value">' + profile.bloodType + '</div>';
            html += '</div>';
            
            html += '<div class="profile-item">';
            html += '<div class="profile-label">ÊòüÂ∫ß</div>';
            html += '<div class="profile-value">' + profile.zodiac + '</div>';
            html += '</div>';
            
            html += '<div class="profile-item">';
            html += '<div class="profile-label">Ë∫´Èï∑</div>';
            html += '<div class="profile-value">' + profile.height + 'cm</div>';
            html += '</div>';
            
            // „Ç´„Çπ„Çø„É†È†ÖÁõÆ
            if (profile.custom && profile.custom.length > 0) {
                profile.custom.forEach(item => {
                    html += '<div class="profile-item">';
                    html += '<div class="profile-label">' + item.label + '</div>';
                    html += '<div class="profile-value">' + item.value + '</div>';
                    html += '</div>';
                });
            }
            
            html += '</div>';
            html += '</div>';
            html += '</div>';
            
            document.getElementById('profilePage').innerHTML = html;
            showPage('profilePage');
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜÁîªÈù¢Ë°®Á§∫
        let editProfilePhoto = ''; // Á∑®ÈõÜ‰∏≠„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Çí‰øùÊåÅ
        
        function editProfile() {
            editProfilePhoto = profile.photo; // ÁèæÂú®„ÅÆÂÜôÁúü„Çí„Çª„ÉÉ„Éà
            
            let html = '<div class="page-container">';
            html += '<h2 style="text-align:center;margin-bottom:30px;">„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ</h2>';
            
            html += '<div class="form-group">';
            html += '<label>„Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü</label>';
            html += '<input type="file" id="editPhotoFile" accept="image/*" onchange="handleProfilePhotoUpload(event)">';
            html += '<div id="profilePhotoPreview" style="margin-top: 10px;"></div>';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>ÂêçÂâç *</label>';
            html += '<input type="text" id="editName" value="' + profile.name + '" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>Ë™ïÁîüÊó•</label>';
            html += '<input type="date" id="editBirthday" value="' + profile.birthday + '">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>Ë°ÄÊ∂≤Âûã</label>';
            html += '<select id="editBloodType">';
            ['A', 'B', 'O', 'AB'].forEach(type => {
                html += '<option value="' + type + '"' + (profile.bloodType === type ? ' selected' : '') + '>' + type + '</option>';
            });
            html += '</select>';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>ÊòüÂ∫ß</label>';
            html += '<input type="text" id="editZodiac" value="' + profile.zodiac + '" placeholder="‰æã: „Åä„ÅÜ„ÅóÂ∫ß">';
            html += '</div>';
            
            html += '<div class="form-group">';
            html += '<label>Ë∫´Èï∑ÔºàcmÔºâ</label>';
            html += '<input type="number" id="editHeight" value="' + profile.height + '" placeholder="‰æã: 160">';
            html += '</div>';
            
            html += '<h3 style="margin-top: 30px; margin-bottom: 15px; font-size: 18px;">„Ç´„Çπ„Çø„É†È†ÖÁõÆ</h3>';
            html += '<div id="customFieldsContainer">';
            
            // Êó¢Â≠ò„ÅÆ„Ç´„Çπ„Çø„É†È†ÖÁõÆ
            if (profile.custom && profile.custom.length > 0) {
                profile.custom.forEach((item, idx) => {
                    html += '<div class="custom-field-item" style="display: flex; gap: 10px; margin-bottom: 10px;">';
                    html += '<input type="text" placeholder="È†ÖÁõÆÂêç" value="' + item.label + '" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" data-custom-label="' + idx + '">';
                    html += '<input type="text" placeholder="ÂÜÖÂÆπ" value="' + item.value + '" style="flex: 2; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" data-custom-value="' + idx + '">';
                    html += '<button class="btn" onclick="removeCustomField(' + idx + ')" style="background: #ff4757; color: white; border-color: #ff4757;">ÂâäÈô§</button>';
                    html += '</div>';
                });
            }
            
            html += '</div>';
            html += '<button class="btn" onclick="addCustomField()" style="margin-top: 10px;">+ „Ç´„Çπ„Çø„É†È†ÖÁõÆ„ÇíËøΩÂä†</button>';
            
            html += '<div class="form-actions" style="margin-top: 30px;">';
            html += '<button class="btn btn-new" onclick="saveProfile()">üíæ ‰øùÂ≠ò</button>';
            html += '<button class="btn" onclick="showProfilePage()">„Ç≠„É£„É≥„Çª„É´</button>';
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('profilePage').innerHTML = html;
            updateProfilePhotoPreview(); // „Éó„É¨„Éì„É•„Éº„ÇíË°®Á§∫
            showPage('profilePage');
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleProfilePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                editProfilePhoto = e.target.result;
                updateProfilePhotoPreview();
            };
            reader.readAsDataURL(file);
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
        function updateProfilePhotoPreview() {
            const preview = document.getElementById('profilePhotoPreview');
            if (!preview) return;
            
            if (editProfilePhoto) {
                preview.innerHTML = '<img src="' + editProfilePhoto + '" style="width:150px;height:150px;object-fit:cover;border-radius:50%;">';
            } else {
                preview.innerHTML = '';
            }
        }
        
        // „Ç´„Çπ„Çø„É†„Éï„Ç£„Éº„É´„ÉâËøΩÂä†
        function addCustomField() {
            const container = document.getElementById('customFieldsContainer');
            const idx = container.children.length;
            
            const div = document.createElement('div');
            div.className = 'custom-field-item';
            div.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
            
            div.innerHTML = `
                <input type="text" placeholder="È†ÖÁõÆÂêç" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" data-custom-label="${idx}">
                <input type="text" placeholder="ÂÜÖÂÆπ" style="flex: 2; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" data-custom-value="${idx}">
                <button class="btn" onclick="removeCustomFieldElement(this)" style="background: #ff4757; color: white; border-color: #ff4757;">ÂâäÈô§</button>
            `;
            
            container.appendChild(div);
        }
        
        // „Ç´„Çπ„Çø„É†„Éï„Ç£„Éº„É´„ÉâÂâäÈô§ÔºàDOMË¶ÅÁ¥†Ôºâ
        function removeCustomFieldElement(btn) {
            btn.parentElement.remove();
        }
        
        // „Ç´„Çπ„Çø„É†„Éï„Ç£„Éº„É´„ÉâÂâäÈô§ÔºàÊó¢Â≠ò„Éá„Éº„ÇøÔºâ
        function removeCustomField(idx) {
            if (confirm('„Åì„ÅÆÈ†ÖÁõÆ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                profile.custom.splice(idx, 1);
                editProfile();
            }
        }
        
        // „Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
        function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const birthday = document.getElementById('editBirthday').value;
            const bloodType = document.getElementById('editBloodType').value;
            const zodiac = document.getElementById('editZodiac').value.trim();
            const height = document.getElementById('editHeight').value.trim();
            
            if (!name) {
                alert('ÂêçÂâç„ÅØÂøÖÈ†à„Åß„Åô');
                return;
            }
            
            // „Ç´„Çπ„Çø„É†È†ÖÁõÆ„ÇíÂèéÈõÜ
            const customFields = [];
            const container = document.getElementById('customFieldsContainer');
            const items = container.querySelectorAll('.custom-field-item');
            
            items.forEach((item, idx) => {
                const labelInput = item.querySelector(`[data-custom-label]`);
                const valueInput = item.querySelector(`[data-custom-value]`);
                
                if (labelInput && valueInput) {
                    const label = labelInput.value.trim();
                    const value = valueInput.value.trim();
                    
                    if (label && value) {
                        customFields.push({ label, value });
                    }
                }
            });
            
            // „Éó„É≠„Éï„Ç£„Éº„É´„ÇíÊõ¥Êñ∞
            profile.photo = editProfilePhoto; // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÁîªÂÉè„Çí‰ΩøÁî®
            profile.name = name;
            profile.birthday = birthday;
            profile.bloodType = bloodType;
            profile.zodiac = zodiac;
            profile.height = height;
            profile.custom = customFields;
            
            // ‰øùÂ≠ò
            localStorage.setItem('diary2_profile', JSON.stringify(profile));
            
            // „Çµ„Ç§„Éâ„Éê„Éº„ÅÆÂêçÂâç„Å®ÂÜôÁúü„ÇÇÊõ¥Êñ∞
            updateSidebarProfile();
            
            alert('„Éó„É≠„Éï„Ç£„Éº„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            showProfilePage();
        }
        
        // Ê§úÁ¥¢Ê©üËÉΩ
        function searchArticles() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÊ∏°„Åó„Å¶Ë®ò‰∫ã‰∏ÄË¶ß„ÇíË°®Á§∫
            showArticlesList(1, query);
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºË°®Á§∫
        function renderCalendar() {
            const year = currentYear;
            const month = currentMonth;
            const firstDay = new Date(year, month, 1).getDay();
            const days = new Date(year, month + 1, 0).getDate();
            
            document.getElementById('calendarMonth').textContent = year + 'Âπ¥' + (month + 1) + 'Êúà';
            
            let html = '';
            
            // ÂâçÊúà„ÅÆÊó•‰ªò
            const prevDays = new Date(year, month, 0).getDate();
            for (let i = firstDay - 1; i >= 0; i--) {
                html += '<div class="calendar-day other-month">' + (prevDays - i) + '</div>';
            }
            
            // ÂΩìÊúà„ÅÆÊó•‰ªò
            for (let d = 1; d <= days; d++) {
                const key = year + '-' + String(month + 1).padStart(2, '0') + '-' + String(d).padStart(2, '0');
                const has = articles[key] && articles[key].status === 'published';
                const hasDraft = articles[key] && articles[key].status === 'draft';
                
                if (has) {
                    html += '<div class="calendar-day has-entry" onclick="showArticle(\'' + key + '\')">' + d + '</div>';
                } else if (hasDraft) {
                    html += '<div class="calendar-day" style="background: #feca57; color: white; font-weight: 600; cursor: pointer;" onclick="showArticle(\'' + key + '\')">' + d + '</div>';
                } else {
                    html += '<div class="calendar-day">' + d + '</div>';
                }
            }
            
            // Ê¨°Êúà„ÅÆÊó•‰ªò
            const remain = 42 - (firstDay + days);
            for (let d = 1; d <= remain; d++) {
                html += '<div class="calendar-day other-month">' + d + '</div>';
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊúàÁßªÂãï
        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }
        
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }
        
        // ÊúÄÊñ∞Ë®ò‰∫ãË°®Á§∫
        function renderNewEntry() {
            const all = Object.entries(articles)
                .filter(([_, a]) => a.status === 'published')
                .sort((a, b) => b[0].localeCompare(a[0]))
                .slice(0, 5);
            
            if (all.length === 0) {
                document.getElementById('newEntryList').innerHTML = 
                    '<div style="text-align:center;color:#999;padding:20px 0;">Ë®ò‰∫ã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const html = all.map(([d, a]) => 
                '<div class="entry-item" onclick="showArticle(\'' + d + '\')">' +
                '<div class="entry-date">' + d + '</div>' +
                '<div class="entry-title">' + a.title + '</div>' +
                '</div>'
            ).join('');
            
            document.getElementById('newEntryList').innerHTML = html;
        }
        
        // „Éö„Éº„Ç∏Âàá„ÇäÊõø„Åà
        function showPage(id) {
            ['dashboard', 'articlePage', 'editPage', 'listPage', 'profilePage'].forEach(p => {
                document.getElementById(p).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
        function showDashboard() {
            renderDashboard();
            renderNewEntry();
            renderCalendar();
            showPage('dashboard');
        }
        
        // „Éá„Éº„Çø‰øùÂ≠ò
        function saveData() {
            localStorage.setItem('diary2_articles', JSON.stringify(articles));
        }
        
        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportData() {
            const data = {
                articles: articles,
                profile: profile,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'diary_backup_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // „Ç§„É≥„Éù„Éº„Éà
        function importData() {
            document.getElementById('importFile').click();
        }
        
        document.getElementById('importFile').onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    articles = data.articles;
                    profile = data.profile;
                    saveData();
                    localStorage.setItem('diary2_profile', JSON.stringify(profile));
                    init();
                    alert('„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ');
                } catch (error) {
                    console.error('„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                    alert('„Ç§„É≥„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };
            reader.readAsText(file);
        };
        
        // ÂàùÊúüÂåñÂÆüË°å
        init();
    </script>
</body>
</html>
